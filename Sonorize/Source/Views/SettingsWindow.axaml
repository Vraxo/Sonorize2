<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Sonorize.ViewModels"
        xmlns:models="using:Sonorize.Models"
        xmlns:controls="using:Sonorize.Controls"
        xmlns:views="using:Sonorize.Views"
        xmlns:utils="using:Sonorize.Utils"
        mc:Ignorable="d" d:DesignWidth="950" d:DesignHeight="750"
        x:Class="Sonorize.Views.SettingsWindow"
        Title="Sonorize" Width="950" Height="750" MinWidth="700" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        Background="{Binding CurrentTheme.B_BackgroundColor}">

	<Window.Resources>
		<views:BooleanToPlayPauseTextConverter x:Key="BooleanToPlayPauseConverter" />
		<views:NotNullToBooleanConverter x:Key="NotNullToBooleanConverter" />
		<utils:BindingProxy x:Key="Proxy" Data="{Binding CurrentTheme}" />
	</Window.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<Menu Grid.Row="0" Background="{Binding CurrentTheme.B_SlightlyLighterBackground}" Foreground="{Binding CurrentTheme.B_TextColor}">
			<MenuItem Header="_File" Foreground="{Binding CurrentTheme.B_TextColor}">
				<MenuItem Header="_Add Music Directory..." Foreground="{Binding CurrentTheme.B_TextColor}"
                          Command="{Binding AddDirectoryAndRefreshCommand}"
                          CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
				<MenuItem Header="_Settings..." Foreground="{Binding CurrentTheme.B_TextColor}"
                          Command="{Binding OpenSettingsCommand}"
                          CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
				<Separator/>
				<MenuItem Header="E_xit" Foreground="{Binding CurrentTheme.B_TextColor}" Command="{Binding ExitCommand}"/>
			</MenuItem>
		</Menu>

		<Panel Grid.Row="1" Margin="0,5,0,0">
			<TextBox Watermark="Search songs by title, artist, or album..."
                     Margin="10,5,10,5" Padding="10,7"
                     Background="{Binding CurrentTheme.B_SlightlyLighterBackground}"
                     Foreground="{Binding CurrentTheme.B_TextColor}"
                     BorderBrush="{Binding CurrentTheme.B_ControlBackgroundColor}"
                     BorderThickness="1" CornerRadius="4" FontSize="14"
                     Text="{Binding SearchQuery, Mode=TwoWay}">
				<TextBox.Styles>
					<Style Selector="TextBox:focus">
						<Setter Property="BorderBrush" Value="{Binding CurrentTheme.B_AccentColor}"/>
					</Style>
				</TextBox.Styles>
			</TextBox>
		</Panel>

		<TabControl Grid.Row="2"
                    Background="{Binding CurrentTheme.B_BackgroundColor}"
                    Margin="10,5,10,5" BorderThickness="0" Padding="0"
                    SelectedIndex="{Binding ActiveTabIndex, Mode=TwoWay}">
			<TabControl.Styles>
				<Style Selector="TabItem">
					<Setter Property="Background" Value="{Binding CurrentTheme.B_BackgroundColor}"/>
					<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_SecondaryTextColor, Source={StaticResource Proxy}}"/>
					<Setter Property="Padding" Value="12,7"/>
					<Setter Property="FontSize" Value="13"/>
					<Setter Property="FontWeight" Value="SemiBold"/>
					<Setter Property="BorderThickness" Value="0"/>
					<Setter Property="BorderBrush" Value="Transparent"/>
				</Style>
				<Style Selector="TabItem:selected">
					<Setter Property="Background" Value="{Binding CurrentTheme.B_BackgroundColor}"/>
					<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_TextColor, Source={StaticResource Proxy}}"/>
				</Style>
				<Style Selector="TabItem:pointerover:not(:selected)">
					<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_SlightlyLighterBackground, Source={StaticResource Proxy}}"/>
					<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_TextColor, Source={StaticResource Proxy}}"/>
				</Style>
			</TabControl.Styles>
			<TabItem Header="LIBRARY">
				<ScrollViewer Padding="0,0,0,5">
					<ListBox Name="SongListBox" Margin="10"
                             Background="{Binding CurrentTheme.B_ListBoxBackground}" BorderThickness="0"
                             ItemsSource="{Binding FilteredSongs}"
                             SelectedItem="{Binding SelectedSong, Mode=TwoWay}">
						<ListBox.Styles>
							<Style Selector="ListBoxItem">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_ListBoxBackground, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_TextColor, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:pointerover:not(:selected)">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_ControlBackgroundColor, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:selected">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_AccentForeground, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:selected:pointerover">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_AccentForeground, Source={StaticResource Proxy}}"/>
							</Style>
						</ListBox.Styles>
						<ListBox.ItemTemplate>
							<DataTemplate DataType="models:Song">
								<Border Padding="10,6,10,6" MinHeight="44" Background="Transparent">
									<Grid VerticalAlignment="Center">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto"/>
											<ColumnDefinition Width="*"/>
											<ColumnDefinition Width="Auto"/>
										</Grid.ColumnDefinitions>
										<Image Grid.Column="0" Width="32" Height="32" Margin="5,0,5,0" Source="{Binding Thumbnail}" Stretch="UniformToFill" RenderOptions.BitmapInterpolationMode="HighQuality"/>
										<StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center" Margin="8,0,0,0">
											<TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Normal" VerticalAlignment="Center" Margin="0,0,0,1"/>
											<TextBlock Text="{Binding Artist}" FontSize="11" VerticalAlignment="Center" Foreground="{Binding DataContext.CurrentTheme.B_SecondaryTextColor, Source={StaticResource Proxy}}"/>
										</StackPanel>
										<TextBlock Grid.Column="2" Text="{Binding DurationString}" FontSize="11" HorizontalAlignment="Right" VerticalAlignment="Center" Foreground="{Binding DataContext.CurrentTheme.B_SecondaryTextColor, Source={StaticResource Proxy}}"/>
									</Grid>
								</Border>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</ScrollViewer>
			</TabItem>
			<TabItem Header="ARTISTS">
				<ScrollViewer Padding="0,0,0,5">
					<ListBox Margin="10" Background="{Binding CurrentTheme.B_ListBoxBackground}" BorderThickness="0"
                             ItemsSource="{Binding Artists}"
                             SelectedItem="{Binding SelectedArtist, Mode=TwoWay}">
						<ListBox.Styles>
							<Style Selector="ListBoxItem">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_ListBoxBackground, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_TextColor, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:pointerover:not(:selected)">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_ControlBackgroundColor, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:selected">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_AccentForeground, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:selected:pointerover">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_AccentForeground, Source={StaticResource Proxy}}"/>
							</Style>
						</ListBox.Styles>
						<ListBox.ItemTemplate>
							<DataTemplate DataType="vm:ArtistViewModel">
								<Border Padding="10,8" MinHeight="44" Background="Transparent">
									<Grid VerticalAlignment="Center">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto"/>
											<ColumnDefinition Width="*"/>
										</Grid.ColumnDefinitions>
										<Image Grid.Column="0" Width="32" Height="32" Margin="5,0,10,0" Source="{Binding Thumbnail}" Stretch="UniformToFill" RenderOptions.BitmapInterpolationMode="HighQuality"/>
										<TextBlock Grid.Column="1" Text="{Binding Name}" FontSize="14" VerticalAlignment="Center"/>
									</Grid>
								</Border>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</ScrollViewer>
			</TabItem>
			<TabItem Header="ALBUMS">
				<ScrollViewer Padding="0,0,0,5">
					<ListBox Margin="10" Background="{Binding CurrentTheme.B_ListBoxBackground}" BorderThickness="0"
                             ItemsSource="{Binding Albums}"
                             SelectedItem="{Binding SelectedAlbum, Mode=TwoWay}">
						<ListBox.Styles>
							<Style Selector="ListBoxItem">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_ListBoxBackground, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_TextColor, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:pointerover:not(:selected)">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_ControlBackgroundColor, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:selected">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_AccentForeground, Source={StaticResource Proxy}}"/>
							</Style>
							<Style Selector="ListBoxItem:selected:pointerover">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
								<Setter Property="Foreground" Value="{Binding DataContext.CurrentTheme.B_AccentForeground, Source={StaticResource Proxy}}"/>
							</Style>
						</ListBox.Styles>
						<ListBox.ItemTemplate>
							<DataTemplate DataType="vm:AlbumViewModel">
								<Border Padding="10,6" MinHeight="44" Background="Transparent">
									<Grid VerticalAlignment="Center">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="Auto"/>
											<ColumnDefinition Width="*"/>
										</Grid.ColumnDefinitions>
										<Image Grid.Column="0" Width="32" Height="32" Margin="5,0,10,0" Source="{Binding Thumbnail}" Stretch="UniformToFill" RenderOptions.BitmapInterpolationMode="HighQuality"/>
										<StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
											<TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Normal" VerticalAlignment="Center"/>
											<TextBlock Text="{Binding Artist}" FontSize="11" Foreground="{Binding DataContext.CurrentTheme.B_SecondaryTextColor, Source={StaticResource Proxy}}" VerticalAlignment="Center"/>
										</StackPanel>
									</Grid>
								</Border>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</ScrollViewer>
			</TabItem>
		</TabControl>

		<Border Grid.Row="3" IsVisible="{Binding IsAdvancedPanelVisible}"
                Background="{Binding CurrentTheme.B_SlightlyLighterBackground}"
                Padding="10" BorderBrush="{Binding CurrentTheme.B_AccentColor}" BorderThickness="0,1,0,1"
                MinHeight="180" ClipToBounds="True">
			<StackPanel Spacing="10">
				<Grid Margin="0,0,0,5">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="15"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<TextBlock Grid.Column="0" Text="Tempo:" VerticalAlignment="Center" Foreground="{Binding CurrentTheme.B_TextColor}" Margin="0,0,5,0"/>
					<Slider Grid.Column="1" Minimum="0.5" Maximum="2.0" SmallChange="0.05" LargeChange="0.25" TickFrequency="0.25"
                            Background="{Binding CurrentTheme.B_SecondaryTextColor}"
                            Value="{Binding PlaybackSpeed, Mode=TwoWay}">
						<Slider.Styles>
							<Style Selector="Thumb">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
							</Style>
						</Slider.Styles>
					</Slider>
					<TextBlock Grid.Column="2" Text="{Binding PlaybackSpeedDisplay}" VerticalAlignment="Center" Margin="5,0" Foreground="{Binding CurrentTheme.B_TextColor}" MinWidth="35" HorizontalAlignment="Right"/>

					<TextBlock Grid.Column="4" Text="Pitch:" VerticalAlignment="Center" Foreground="{Binding CurrentTheme.B_TextColor}" Margin="0,0,5,0"/>
					<Slider Grid.Column="5" Minimum="-4" Maximum="4" SmallChange="0.1" LargeChange="0.5" TickFrequency="0.5"
                            Background="{Binding CurrentTheme.B_SecondaryTextColor}"
                            Value="{Binding PlaybackPitch, Mode=TwoWay}">
						<Slider.Styles>
							<Style Selector="Thumb">
								<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
							</Style>
						</Slider.Styles>
					</Slider>
					<TextBlock Grid.Column="6" Text="{Binding PlaybackPitchDisplay}" VerticalAlignment="Center" Margin="5,0" Foreground="{Binding CurrentTheme.B_TextColor}" MinWidth="45" HorizontalAlignment="Right"/>
				</Grid>

				<Panel>
					<controls:WaveformDisplayControl Name="WaveformDisplay" Height="80" MinHeight="60"
                                                     Background="{Binding CurrentTheme.B_ControlBackgroundColor}"
                                                     WaveformBrush="{Binding CurrentTheme.B_AccentColor}"
                                                     PositionMarkerBrush="OrangeRed"
                                                     LoopRegionBrush="{Binding DataContext.CurrentTheme.B_AccentColor, Converter={StaticResource BrushAlphaConverter}, ConverterParameter=0.3, Source={StaticResource Proxy}}"
                                                     WaveformPoints="{Binding WaveformRenderData}"
                                                     CurrentPosition="{Binding PlaybackService.CurrentPosition}"
                                                     Duration="{Binding PlaybackService.CurrentSongDuration}"
                                                     ActiveLoop="{Binding PlaybackService.CurrentSong.SavedLoop}"
                                                     SeekRequested="WaveformDisplay_SeekRequested"/>
					<ProgressBar IsIndeterminate="True" Height="5" Margin="0,-5,0,0"
                                 IsVisible="{Binding IsWaveformLoading}"
                                 Foreground="{Binding CurrentTheme.B_AccentColor}"
                                 Background="Transparent"/>
				</Panel>

				<StackPanel Orientation="Vertical" Spacing="5" Margin="0,10,0,0">
					<TextBlock Text="Define Loop:" FontSize="12" FontWeight="SemiBold" Foreground="{Binding CurrentTheme.B_TextColor}"/>
					<StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
						<Button Content="A" FontSize="12" Padding="10,5" MinWidth="40" Background="{Binding CurrentTheme.B_ControlBackgroundColor}" Foreground="{Binding CurrentTheme.B_TextColor}" Command="{Binding CaptureLoopStartCandidateCommand}"/>
						<TextBlock Text="{Binding NewLoopStartCandidateDisplay}" FontSize="11" Margin="3,0" VerticalAlignment="Center" Foreground="{Binding CurrentTheme.B_SecondaryTextColor}" MinWidth="60"/>
						<Button Content="B" FontSize="12" Padding="10,5" MinWidth="40" Background="{Binding CurrentTheme.B_ControlBackgroundColor}" Foreground="{Binding CurrentTheme.B_TextColor}" Command="{Binding CaptureLoopEndCandidateCommand}"/>
						<TextBlock Text="{Binding NewLoopEndCandidateDisplay}" FontSize="11" Margin="3,0" VerticalAlignment="Center" Foreground="{Binding CurrentTheme.B_SecondaryTextColor}" MinWidth="60"/>
						<Button Content="Save Loop" FontSize="11" Padding="10,5" Background="{Binding CurrentTheme.B_AccentColor}" Foreground="{Binding CurrentTheme.B_AccentForeground}" Command="{Binding SaveLoopCommand}" IsEnabled="{Binding CanSaveLoopRegion}"/>
						<Button Content="Clear Loop" FontSize="11" Padding="10,5" Background="{Binding CurrentTheme.B_ControlBackgroundColor}" Foreground="{Binding CurrentTheme.B_TextColor}" Command="{Binding ClearLoopCommand}" IsEnabled="{Binding PlaybackService.CurrentSong.SavedLoop, Converter={StaticResource NotNullToBooleanConverter}}"/>
					</StackPanel>
					<StackPanel Orientation="Horizontal" Margin="0,8,0,0" Spacing="8" VerticalAlignment="Center">
						<CheckBox Content="Activate Loop" Foreground="{Binding CurrentTheme.B_TextColor}" VerticalAlignment="Center"
                                  IsChecked="{Binding IsCurrentLoopActiveUiBinding, Mode=TwoWay}"
                                  IsEnabled="{Binding PlaybackService.CurrentSong.SavedLoop, Converter={StaticResource NotNullToBooleanConverter}}"/>
					</StackPanel>
				</StackPanel>
			</StackPanel>
		</Border>

		<StackPanel Grid.Row="4" Orientation="Vertical" Background="{Binding CurrentTheme.B_BackgroundColor}" Margin="0,5,0,5">
			<DockPanel LastChildFill="True" Height="35" Margin="5,0,5,0">
				<StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center" Margin="5,0,10,0">
					<Button Name="MainPlayPauseButton" Padding="10,5" MinWidth="70"
                            Background="{Binding CurrentTheme.B_SlightlyLighterBackground}"
                            Foreground="{Binding CurrentTheme.B_TextColor}"
                            BorderBrush="{Binding CurrentTheme.B_AccentColor}"
                            BorderThickness="1" CornerRadius="3"
                            Content="{Binding PlaybackService.IsPlaying, Converter={StaticResource BooleanToPlayPauseConverter}}"
                            IsEnabled="{Binding PlaybackService.HasCurrentSong}"
                            Click="MainPlayPauseButton_Click"/>
					<Button Content="+" Padding="8,4" MinWidth="30" FontWeight="Bold" Margin="5,0,0,0"
                            Background="{Binding CurrentTheme.B_SlightlyLighterBackground}"
                            Foreground="{Binding CurrentTheme.B_TextColor}"
                            BorderBrush="{Binding CurrentTheme.B_AccentColor}"
                            BorderThickness="1" CornerRadius="3"
                            Command="{Binding ToggleAdvancedPanelCommand}"
                            IsEnabled="{Binding PlaybackService.HasCurrentSong}"/>
				</StackPanel>
				<Slider Name="MainPlaybackSliderInstance" Minimum="0" Margin="10,0" VerticalAlignment="Center"
                        Background="{Binding CurrentTheme.B_SecondaryTextColor}"
                        Maximum="{Binding PlaybackService.CurrentSongDurationSeconds}"
                        Value="{Binding SliderPositionSeconds, Mode=TwoWay}"
                        IsEnabled="{Binding PlaybackService.HasCurrentSong}">
					<Slider.Styles>
						<Style Selector="Thumb">
							<Setter Property="Background" Value="{Binding DataContext.CurrentTheme.B_AccentColor, Source={StaticResource Proxy}}"/>
						</Style>
					</Slider.Styles>
				</Slider>
			</DockPanel>
			<TextBlock Text="{Binding ActiveLoopDisplayText}" Foreground="{Binding CurrentTheme.B_SecondaryTextColor}" FontSize="10" HorizontalAlignment="Center" Margin="10,0,10,2" MinHeight="14"/>
		</StackPanel>

		<Border Grid.Row="5" Background="{Binding CurrentTheme.B_SlightlyLighterBackground}" Padding="10,4" Height="26">
			<TextBlock Text="{Binding StatusBarText}" Foreground="{Binding CurrentTheme.B_SecondaryTextColor}" VerticalAlignment="Center" FontSize="11"/>
		</Border>
	</Grid>
</Window>